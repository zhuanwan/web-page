import{_ as n,c as s,o as a,a as t}from"./app-Ba5SHWBn.js";const p={},o=t(`<h1 id="画布拖动和缩放" tabindex="-1"><a class="header-anchor" href="#画布拖动和缩放"><span>画布拖动和缩放</span></a></h1><p>默认鼠标点击拖动是框选<code>canvas.selection</code>，左右移动有两种方法</p><p>1、记录上一次鼠标移动位置， 设置 <code>x：viewportTransform[4]</code> <code> y: viewportTransform[5]</code></p><p>2、canvas.relativePan 相对定位，设置相对上一次的距离，参考<a href="/web-page/fabric/%E5%85%83%E7%B4%A0%E6%93%8D%E4%BD%9C/%E5%85%83%E7%B4%A0%E5%AE%9A%E4%BD%8D">元素定位</a></p><p><strong>canvas.off</strong></p><p><strong>canvas.on</strong></p><p><strong>canvas.clear()</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;mouse:down&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">opt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> evt <span class="token operator">=</span> opt<span class="token punctuation">.</span>e
  canvas<span class="token punctuation">.</span>isDragging <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// isDragging 是自定义的</span>
  canvas<span class="token punctuation">.</span>lastPosX <span class="token operator">=</span> evt<span class="token punctuation">.</span>clientX <span class="token comment">// lastPosX 是自定义的</span>
  canvas<span class="token punctuation">.</span>lastPosY <span class="token operator">=</span> evt<span class="token punctuation">.</span>clientY <span class="token comment">// lastPosY 是自定义的</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

canvas<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;mouse:up&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// canvas.setViewportTransform(canvas.viewportTransform) // 设置此画布实例的视口转换</span>
  canvas<span class="token punctuation">.</span>isDragging <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

canvas<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;mouse:move&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">opt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>isDragging<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> evt <span class="token operator">=</span> opt<span class="token punctuation">.</span>e
    <span class="token keyword">let</span> vpt <span class="token operator">=</span> canvas<span class="token punctuation">.</span>viewportTransform <span class="token comment">// 聚焦视图的转换</span>
    vpt<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+=</span> evt<span class="token punctuation">.</span>clientX <span class="token operator">-</span> canvas<span class="token punctuation">.</span>lastPosX
    vpt<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">+=</span> evt<span class="token punctuation">.</span>clientY <span class="token operator">-</span> canvas<span class="token punctuation">.</span>lastPosY
    canvas<span class="token punctuation">.</span><span class="token function">requestRenderAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    canvas<span class="token punctuation">.</span>lastPosX <span class="token operator">=</span> evt<span class="token punctuation">.</span>clientX
    canvas<span class="token punctuation">.</span>lastPosY <span class="token operator">=</span> evt<span class="token punctuation">.</span>clientY
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

canvas<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;mouse:wheel&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">opt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> delta <span class="token operator">=</span> opt<span class="token punctuation">.</span>e<span class="token punctuation">.</span>deltaY <span class="token comment">// 滚轮，向上滚一下是 -100，向下滚一下是 100</span>
  <span class="token keyword">let</span> zoom <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getZoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 获取画布当前缩放值</span>
  zoom <span class="token operator">*=</span> <span class="token number">0.999</span> <span class="token operator">**</span> delta
  <span class="token keyword">if</span> <span class="token punctuation">(</span>zoom <span class="token operator">&gt;</span> <span class="token number">20</span><span class="token punctuation">)</span> zoom <span class="token operator">=</span> <span class="token number">20</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>zoom <span class="token operator">&lt;</span> <span class="token number">0.01</span><span class="token punctuation">)</span> zoom <span class="token operator">=</span> <span class="token number">0.01</span>

  <span class="token comment">// 以左上角为原点</span>
  canvas<span class="token punctuation">.</span><span class="token function">setZoom</span><span class="token punctuation">(</span>zoom<span class="token punctuation">)</span>

  <span class="token comment">// 以鼠标所在位置为原点缩放</span>
  <span class="token comment">// canvas.zoomToPoint(</span>
  <span class="token comment">//   {</span>
  <span class="token comment">//     x: opt.e.offsetX,</span>
  <span class="token comment">//     y: opt.e.offsetY,</span>
  <span class="token comment">//   },</span>
  <span class="token comment">//   zoom</span>
  <span class="token comment">// )</span>
  opt<span class="token punctuation">.</span>e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  opt<span class="token punctuation">.</span>e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">let</span> panning <span class="token operator">=</span> <span class="token boolean">false</span>
canvas<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;mouse:down&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">opt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  panning <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token comment">// canvas.selection = false; // 禁止元素框选</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

canvas<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;mouse:up&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  panning <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token comment">// canvas.selection = true;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

canvas<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;mouse:move&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">opt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>panning <span class="token operator">&amp;&amp;</span> opt <span class="token operator">&amp;&amp;</span> opt<span class="token punctuation">.</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> delta <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fabric<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span>opt<span class="token punctuation">.</span>e<span class="token punctuation">.</span>movementX<span class="token punctuation">,</span> opt<span class="token punctuation">.</span>e<span class="token punctuation">.</span>movementY<span class="token punctuation">)</span>
    canvas<span class="token punctuation">.</span><span class="token function">relativePan</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,9),e=[o];function c(l,i){return a(),s("div",null,e)}const r=n(p,[["render",c],["__file","画布拖动和缩放.html.vue"]]),k=JSON.parse('{"path":"/fabric/%E7%94%BB%E5%B8%83%E6%93%8D%E4%BD%9C/%E7%94%BB%E5%B8%83%E6%8B%96%E5%8A%A8%E5%92%8C%E7%BC%A9%E6%94%BE.html","title":"画布拖动和缩放","lang":"zh-CN","frontmatter":{},"headers":[],"git":{"updatedTime":1716273961000,"contributors":[{"name":"wu.hui","email":"wu.hui@qkupower.com","commits":1}]},"filePathRelative":"fabric/画布操作/画布拖动和缩放.md"}');export{r as comp,k as data};
